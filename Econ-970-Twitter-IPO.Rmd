---
title: "Twitter IPO"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(twitteR)
library(rtweet)
library(stringr)
library(lubridate)
library(purrr)
library(RCurl)
library(openssl)
library(tidyverse)
library(dplyr)
library(ggplot2)
```

# TWITTER
```{r}
# AUTHORIZATION

api_key <- "8pV4MffGxAj5EjDRoxMfUGbNF"
api_key_secret <- "lY1vkaBeWgGJVjpsIM8vC9iGRt2CSqTp1Z8yqwpAyF2lcXKZDl"
bearer_token <- "AAAAAAAAAAAAAAAAAAAAAMrjbAEAAAAAc79%2F0X%2B7SG3dwAyiDRCp0ldfA7M%3DHwUVD9XHKhmcCQZOm2p9C0YOYfCfHg4Ug4UykUAUbj2cMD2S3M"

token <- create_token(
  app = "Econ970twitteripo",
  consumer_key = api_key,
  consumer_secret = api_key_secret)

```


```{r}
uber_tweets <- rtweet::get_timeline(c("uber"), n = 3000, parse=T, token = token)
rtweet::write_as_csv(uber_tweets, "uber_tweets.csv", prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")
```




# IPO
```{r}
ipo2021 <- read.csv("~/Downloads/ipos-2021.csv")

ipo2021 <- ipo2021 %>%
  mutate("IPO.q1" = str_detect(IPO.Date, c("Jan", "Feb", "Mar"), negate = FALSE)) %>%
  filter(IPO.q1 == TRUE) %>%
  mutate(IPO.Date = as.Date(IPO.Date, format = "%b %d, %Y"),
         IPO.1Mbefore = IPO.Date %m-% months(1),
         IPO.3Mbefore = IPO.Date %m-% months(3),
         short.name = gsub(",.*", "\\1",
                           gsub("Corp..*", "\\1",
                                gsub("Co..*", "\\1", 
                                     gsub("Ltd..*", "\\1", Company.Name)))))
```

```{r}
test <- ipo2021 %>%
  select(IPO.Date, IPO.3Mbefore, IPO.1Mbefore, Company.Name) %>%
  mutate(short.name = gsub(",.*", "\\1",
                           gsub("Corp..*", "\\1",
                                gsub("Co..*", "\\1", 
                                     gsub("Ltd..*", "\\1", Company.Name)))))

words <- paste(c(", Inc.", "Corp.", "Co.", "Ltd.", "Limited", "Corporation", "II", "III", "IV", "VI"), collapse = "|")
test$short.name <- trimws(gsub(words, "\\1", test$Company.Name))

x <- ipo2021[3, 3]
search_users(x)

```


```{r}
for (i in 1:nrow(ipo2021)){
  x <- ipo2021[i, 3]
  searchTwitter(x, since=ipo2021$IPO.3Mbefore, until=ipo2021$IPO.Date)
}
```

























